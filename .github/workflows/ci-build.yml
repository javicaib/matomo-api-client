name: Java CI con Gradle y Build JAR

on:
  # Disparar el workflow en cada push a la rama principal/master
  push:
    branches: [ "main", "master" ]
  # Permite ejecutar manualmente
  workflow_dispatch:

jobs:
  build:
    # Ejecutar en una mÃ¡quina virtual de Ubuntu
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¦ Checkout del CÃ³digo
        # Trae el cÃ³digo del repositorio
        uses: actions/checkout@v4

      - name: â˜• Configurar Java 17 (Ajusta la versiÃ³n si es necesario)
        # Instala la versiÃ³n de Java
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle' # Configura el cachÃ© para dependencias de Gradle

      - name: ðŸ“„ Conceder Permisos al Wrapper de Gradle
        # Es necesario para que el script 'gradlew' pueda ejecutarse en Linux/Unix
        run: chmod +x gradlew

      - name: ðŸ”¨ Compilar, Probar y Empaquetar con Gradle
        # El task 'build' de Gradle limpia, compila, ejecuta tests y genera el JAR
        run: ./gradlew build -x test

      # Opcional: Si quieres ejecutar los tests en un paso separado:
      # - name: ðŸ§ª Ejecutar Tests Unitarios
      #   run: ./gradlew test

      - name: ðŸ’¾ Subir el Archivo JAR Resultante
        # Sube el JAR como un "artifact" para que puedas descargarlo.
        # El JAR se encuentra tÃ­picamente en build/libs/
        uses: actions/upload-artifact@v4
        with:
          name: my-app-jar
          # Busca cualquier archivo JAR dentro del directorio 'build/libs/'
          path: build/libs/*.jar
          retention-days: 7