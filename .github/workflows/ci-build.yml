name: Java CI con Gradle y Build JAR

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    # Define permisos necesarios para escribir artifacts y usar GITHUB_TOKEN
    permissions:
      contents: read
      packages: write

    steps:
      - name: ğŸ“¦ Checkout del CÃ³digo
        uses: actions/checkout@v4 # Usar v4 es mÃ¡s estÃ¡ndar y estable

      - name: â˜• Configurar Java 17
        uses: actions/setup-java@v4 # Usar v4 es mÃ¡s estÃ¡ndar
        with:
          java-version: '17'
          distribution: 'temurin'
          cache: 'gradle'

      - name: ğŸ“„ Conceder Permisos al Wrapper de Gradle
        # Â¡ESTE ES EL PASO CRUCIAL QUE FALTABA!
        # Necesario en los runners de Linux para poder ejecutar el script 'gradlew'.
        run: chmod +x gradlew

      - name: ğŸ› ï¸ Configurar Gradle
        # Esta acciÃ³n ya maneja el cachÃ© y la configuraciÃ³n del entorno.
        uses: gradle/actions/setup-gradle@v3 # Usar la Ãºltima versiÃ³n estable (v3)

      - name: ğŸ”¨ Build con Gradle (Compila y ejecuta Tests)
        run: ./gradlew build

      # --- PASOS PARA PUBLICAR (OPCIONAL) ---
      # (Solo si tu proyecto estÃ¡ configurado para publicar en el archivo build.gradle)

      - name: â¬†ï¸ Publish to GitHub Packages
        # AsegÃºrate de que el 'publishing' block en tu build.gradle use las credenciales USERNAME y TOKEN.
        run: ./gradlew publish
        env:
          USERNAME: ${{ github.actor }}
          TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # --- PASO PARA SUBIR EL ARTEFACTO (JAR) ---

      - name: ğŸ’¾ Subir el Archivo JAR como Artifact
        # Esto permite descargar el JAR compilado desde la interfaz de GitHub Actions
        uses: actions/upload-artifact@v4
        with:
          name: my-app-jar
          path: build/libs/*.jar